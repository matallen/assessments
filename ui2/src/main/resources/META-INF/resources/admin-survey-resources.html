<html lang="EN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Admin @ Assessments | Red Hat Inc</title>
	<meta name="description" content="Red Hat Assessment Platform">
	<meta name="robots" content="noindex">
	<meta name="viewport" content="width=device-width, initial scale= 1.0">
	<meta property="og:title" content="Assessments | Red Hat Inc">
	<meta property="og:description" content="">
  <link rel="preload" href="/assets/fonts/RedHatText/RedHatText-Regular.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatText/RedHatText-Medium.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Regular.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Medium.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Bold.woff" as="font" type="font/woff" crossorigin>
  <link type="text/css" rel="stylesheet" href="/assets/fonts/red-hat-font.css" media="all" />
  <link rel="icon" href="https://www.redhat.com/favicon.ico">
	<style id="customStyles">
	@import "https://www.redhat.com/ux/webdms/css/styles.min.css";
	</style>
	
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script>
	$(function(){
	  jQuery.each($('[data-include]'), function(){
	    var file = 'components/' + $(this).data('include') + '.html';
	    $(this).load(file);
	  });
	});
	</script>
	<script src="assets/js/http.js"></script>
	<script src="assets/js/utils.js"></script>
	<script src="assets/js/env.js"></script>
	<script src="assets/js/feedback-alert.js"></script>
	
	<link rel="stylesheet" href="assets/css/header.css">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/css/controls-slide-switch.css">
	
	<!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css"-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
	
	<!-- Header (+Logo) -->
	<div id="header">
		<div class="navbar-container">
			<div class="container">
				<div class="row">
					<div class="col-md-3" >
						<a class="navbar-brand" href="//www.redhat.com/" title="Red Hat"><img alt="Red Hat" class="img-fluid navbar-logo" data-alt-text="Red Hat" src="/assets/images/red-hat_white.svg?t=1537976200708" title="Red Hat" data-image-state="ready"> </a>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Breadcrumb Menu -->
	<div class="elevate" style="height: 27px">
		<ul style="float:left" class="menu menu_horizontal">
			<li><a href="admin.html">Surveys</a></li>
			<li class="noColor divider">/</li>
			<li class="noColor menu_needsId _id"><span style="color:white;">UNSET</span></li>
			<li class="noColor divider">|</li>
			<li class="menu_needsId"><a href="admin-survey-details.html?id=">Details</a></li>
			<li class="menu_needsId"><a href="admin-survey-reports.html?id=">Reports</a></li>
			<!--li class="menu_needsId"><a href="admin-survey-questions.html?id=">Questions</a></li-->
			<li class="menu_needsId"><a href="admin-survey-questions-embedded.html?id=">Questions</a></li>
			<!--li class="menu_needsId"><a href="admin-survey-eloqua.html?id=">Eloqua</a></li-->
			<li class="menu_needsId"><a href="admin-survey-plugins.html?id=">Plugins</a></li>
			<li class="menu_needsId"><a href="admin-survey-resources.html?id=">Resources</a></li>
			<li class="menu_needsId"><a href="admin-survey-results-rules.html?id=">Results Rules</a></li>
			<li class="menu_needsId"><a href="admin-survey-results.html?id=">Results Page</a></li>
			<li class="menu_needsId"><a href="admin-survey-data-management.html?id=">Data</a></li>
			<li class="menu_needsId"><a href="admin-survey-settings.html?id=">Settings</a></li>
		</ul>
		<ul style="float:right" class="menu menu_horizontal">
			<li><a id="logout" href="/logout">Logout</a></li>
		</ul>
		<script>
			$(document).ready(function() {
				$("a[id=logout]").attr("href", env.server+$("a[id=logout]").attr("href")+"?onSuccess="+document.location.origin+"/login.html");
			});	
		</script>
	</div>
	
	<!-- success/error message --> 
	<div class="alert alert-success" id="feedback-alert" style="display:none">
    <button type="button" class="close" data-dismiss="alert">x</button>
    <span id="feedback-alert-text">&nbsp;</span>
	</div>
	
	<!-- Main Content -->
	<div class="container py-1">
		<table class="elevate">
			<tbody id="content">
				<tr>
					<td>
						<h2>Resources</h2>
						<p>
						 The purpose of this page is to upload images and other resources that the survey or report can show or link to
						</p>
						<!--
						<textarea id="_resources" style="width: 100%; height: 800px;"></textarea>
						-->
						<!--
						<input type="text" id="filename" name="filename"/>
						-->
						<input type="file" id="file" name="file"/>
						<input type="button" value="Upload" onclick="return upload();"/>
						<div id="progress-wrp">
					    <div class="progress-bar"></div>
					    <div class="status">0%</div>
						</div>
						
						<div id="resourceList"></div>
						
					</td>
				</tr>
				<!--
				<tr>
					<td colspan="2">
					<a style="line-height: 0.3 !important;" class="btn btn-outline-black mt-2 mb-1 btn-color-white" href="#" onclick="alert('Be patient! I said this is not implemented yet!');">Save</a>
					<!--a style="line-height: 0.3 !important;" class="btn btn-outline-black mt-2 mb-1 btn-color-white" href="/admin.html">Cancel</a->
					</td>
				</tr>
				-->
			</tbody>
		</table>
	</div>
	
	<style>
#progress-wrp {
  border: 1px solid #0099CC;
  padding: 1px;
  position: relative;
  height: 30px;
  border-radius: 3px;
  margin: 10px;
  text-align: left;
  background: #fff;
  box-shadow: inset 1px 3px 6px rgba(0, 0, 0, 0.12);
}

#progress-wrp .progress-bar {
  height: 100%;
  border-radius: 3px;
  background-color: #c10000;
  width: 0;
  box-shadow: inset 1px 1px 10px rgba(0, 0, 0, 0.11);
}

#progress-wrp .status {
  top: 3px;
  left: 50%;
  position: absolute;
  display: inline-block;
  color: #FFF;
}
	</style>
	
	<script>


var surveyId=Utils.getParameterByName("id");
setMenu("Resources");
$(document).ready(function() {
	$("#feedback-alert").hide();
	
	if (undefined!=surveyId){
		
		refreshDisplay();
		
	}else{
		// Throw error message to page saying survey doesnt exist
	}
	
//	attachUploadHandler();
	
	
	
});


function refreshDisplay(){
	Http.httpGetObject(env.server+"/api/surveys/"+surveyId+"/resources", function(status, resources){
		updateDisplay(resources);
	}, function(status){
		// on error
	});
}
function updateDisplay(resources){
	var html="<table>";
	html+="<head><tr><th>File:</th><th>Relative Path (for use in questions & results):</th></tr></thead><tbody>";
	for (var r in resources){
		html+=`<tr><td><a href="`+resources[r]["path"]+`">`+resources[r]["name"]+`</a>`;
		html+=`&nbsp;<a href="#" onclick="deleteResource('`+resources[r]["path"]+`');"><i class="fa fa-trash"></i></a>`;
		html+=`</td><td>`+resources[r]["path"]+`</td></tr>`;
	}
	html+="</tbody></html>";
	$("#resourceList").html(html);
}

function deleteResource(path){
	Http.httpDelete(env.server+path, null, function(xhr, status){
		//console.log("DELETE status="+status);
		//console.log("DELETE xhr.response="+JSON.parse(xhr.response));
		updateDisplay(JSON.parse(xhr.response));
		if (200==status){
		}else{
		}
	});
}
function attachUploadHandler(){
	$("#file").on("change", function (e) {
		upload($(this));
	});
}
function upload(){
	var file=$("#file")[0].files[0];
	//var file = $(this)[0].files[0];
	var upload = new Upload(file);

	// mayby check size or type here with upload.getSize() and upload.getType()
	console.log("file size: "+upload.getSize());
	if (upload.getSize()>150000){
		showSuccess("Cannot upload files more than 150k in size");
		return;
	}
	
	// execute upload
	upload.doUpload();
}


var Upload = function (file) {
    this.file = file;
};
Upload.prototype.getType = function() {
    return this.file.type;
};
Upload.prototype.getSize = function() {
    return this.file.size;
};
Upload.prototype.getName = function() {
    return this.file.name;
};
Upload.prototype.doUpload = function () {
    var that = this;
    var formData = new FormData();

    // add assoc key values, this will be posts values
    formData.append("file", this.file, this.getName());
    //formData.append("filename", "test1");
    //formData.append("upload_file", true);

    $.ajax({
        type: "POST",
        url: env.server+"/api/surveys/"+surveyId+"/resources",
        headers: {
        	"Authorization": "Bearer "+Http.getCookie("rh_cat_jwt")
        },
        xhr: function () {
            var myXhr = $.ajaxSettings.xhr();
            if (myXhr.upload) {
                myXhr.upload.addEventListener('progress', that.progressHandling, false);
            }
            return myXhr;
        },
        success: function (data) {
            // your callback here
          //console.log("response.status="+JSON.stringify(data));
        	showSuccess("File uploaded");
        	updateDisplay(data);
        },
        error: function (error) {
            // handle error
        	showSuccess("Error: "+error);
        },
        async: true,
        data: formData,
        cache: false,
        contentType: false,
        processData: false,
        timeout: 60000
    });
};

Upload.prototype.progressHandling = function (event) {
    var percent = 0;
    var position = event.loaded || event.position;
    var total = event.total;
    var progress_bar_id = "#progress-wrp";
    if (event.lengthComputable) {
        percent = Math.ceil(position / total * 100);
    }
    // update progressbars classes so it fits your code
    $(progress_bar_id + " .progress-bar").css("width", +percent + "%");
    $(progress_bar_id + " .status").text(percent + "%");
};


	</script>

</body>
</html>