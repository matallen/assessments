<!DOCTYPE html>
<html lang="EN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Admin @ Assessments | Red Hat Inc</title>
	<meta name="description" content="Red Hat Assessment Platform">
	<meta name="robots" content="noindex">
	<meta name="viewport" content="width=device-width, initial scale= 1.0">
	<meta property="og:title" content="Assessments | Red Hat Inc">
	<meta property="og:description" content="">
  <link rel="preload" href="/assets/fonts/RedHatText/RedHatText-Regular.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatText/RedHatText-Medium.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Regular.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Medium.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="/assets/fonts/RedHatDisplay/RedHatDisplay-Bold.woff" as="font" type="font/woff" crossorigin>
  <link type="text/css" rel="stylesheet" href="/assets/fonts/red-hat-font.css" media="all" />
  <link rel="icon" href="https://www.redhat.com/profiles/rh/themes/redhatdotcom/favicon.ico">
	<style id="customStyles">
	@import "https://go.redhat.com/hubfs/css/styles.min.css";
	</style>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script>
	$(function(){
	  jQuery.each($('[data-include]'), function(){
	    var file = 'components/' + $(this).data('include') + '.html';
	    $(this).load(file);
	  });
	});
	</script>
	<script src="assets/js/http.js"></script>
	<script src="assets/js/utils.js"></script>
	<script src="assets/js/env.js"></script>
	<script src="assets/js/feedback-alert.js"></script>
	<link rel="stylesheet" href="assets/css/header.css">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/css/results.css">
</head>
<body class="admin">

	<!-- Header (+Logo) -->
	<div id="header">
		<div class="navbar-container">
			<div class="container">
				<div class="row">
					<div class="col-md-3" >
						<a class="navbar-brand" href="//www.redhat.com/" title="Red Hat"><img alt="Red Hat" class="img-fluid navbar-logo" data-alt-text="Red Hat" src="https://go.redhat.com/hubfs/images/logos/red-hat_white.svg?t=1537976200708" title="Red Hat" data-image-state="ready"> </a>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Breadcrumb Menu -->
	<div class="elevate" style="height: 27px">
		<ul style="float:left" class="menu menu_horizontal">
			<li><a href="admin.html">Surveys</a></li>
			<li class="noColor divider">/</li>
			<li class="noColor menu_needsId _id"><span style="color:white;">UNSET</span></li>
			<li class="noColor divider">|</li>
			<li class="menu_needsId"><a href="admin-survey-details.html?id=">Details</a></li>
			<li class="menu_needsId"><a href="admin-survey-reports.html?id=">Reports</a></li>
			<!--li class="menu_needsId"><a href="admin-survey-questions.html?id=">Questions</a></li-->
			<li class="menu_needsId"><a href="admin-survey-questions-embedded.html?id=">Questions</a></li>
			<!--li class="menu_needsId"><a href="admin-survey-eloqua.html?id=">Eloqua</a></li-->
			<li class="menu_needsId"><a href="admin-survey-plugins.html?id=">Plugins</a></li>
			<li class="menu_needsId"><a href="admin-survey-resources.html?id=">Resources</a></li>
			<li class="menu_needsId"><a href="admin-survey-results.html?id=">Results</a></li>
			<li class="menu_needsId"><a href="admin-survey-data-management.html?id=">Data</a></li>
			<li class="menu_needsId"><a href="admin-survey-settings.html?id=">Settings</a></li>
		</ul>
		<ul style="float:right" class="menu menu_horizontal">
			<li><a id="logout" href="/logout">Logout</a></li>
		</ul>
		<script>
			$(document).ready(function() {
				$("a[id=logout]").attr("href", env.server+$("a[id=logout]").attr("href")+"?onSuccess="+document.location.origin+"/login.html");
			});	
		</script>
	</div>
	
	<!-- success/error message --> 
	<div class="alert alert-success" id="feedback-alert" style="display:none">
    <button type="button" class="close" data-dismiss="alert">x</button>
    <span id="feedback-alert-text">&nbsp;</span>
	</div>
	
	<!-- Main Content -->
	<div class="container py-1">
		<!--
		<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js"></script>
	  <script src="/assets/js/tinymce.min.js"></script>
		<script src="https://cdn.tiny.cloud/1/kqjorf16lbrjslj3o5d6t1or1fffjsa43hhp3s5kaoeyt1ir/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>		
		-->
		<!--
	  <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
	  <script src="/assets/js/tinymce-4.js"></script>
	  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
		-->
	  <script src="https://cdn.tiny.cloud/1/zgiryb2ntve6qb475f3q1xy7vm6yg7p6q9n4k8e9k75sp3z1/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
	  
	  <!--script src="http://cdn.tinymce.com/4/plugins/advcode/plugin.min.js"></script-->
		<script>
//			tinymce.init({
//			  selector: 'textarea',  // change this value according to your HTML
//			  plugins: 'code,autoresize,fullpage',
//			  toolbar: '' //code - this seems to disable all the other toolbars
//			  
////			  ,extended_valid_elements: "style"
//			});
		</script>
		<style>
		.admin .section{
			margin-bottom: 35px;
			padding: 10px 20px;
		}
		.admin table tbody tr td{
			vertical-align: top;
		}
		</style>
		
		<div class="elevate section">
			<table><tr>
					<td><label for="title">Results Page Title:</label></td>
					<td><input id="_results_title" type="text" style="width:350px;"/></td>
					</tr><tr>
					<td><label for="title">Hide "Print Preview" button:</label></td>
					<td><input id="_results_hide_print_button" type="checkbox" style="width:350px;"/></td>
					
			</tr></table>
		</div>
		<div class="elevate section">
			<table>
					<tr><td><label for="title">Results Page Header:</label></td></tr>
					<tr><td><textarea onblue="return save();" id="_results_header"></textarea></td></tr>
			</table>
		</div>
		<div class="elevate section">
			<table>
					<tr><td><label for="title">Results Page Footer:</label></td></tr>
					<tr><td><textarea onblur="return save();" id="_results_footer"></textarea></td></tr>
			</table>
		</div>
		
		<div class="elevate section">
			<a style="line-height: 0.3 !important;" class="btn btn-outline-black mt-2 mb-1 btn-color-white" href="#" onclick="save();">Save</a>
		</div>
		
	</div>
	
<script>

var surveyId=Utils.getParameterByName("id");
setMenu("Results");
$(document).ready(function() {
	$("#feedback-alert").hide();
	
	Http.httpGetObject(env.server+"/api/surveys/"+surveyId+"/resources", function(status, resources){
		var tiny_content_css="/assets/css/style.css";
		for(i in resources){
			if (resources[i]["path"].endsWith(".css")){
				//$(this).load(resources[i]["path"]);
				tiny_content_css+=(tiny_content_css.length>0?",":"")+ resources[i]["path"];
			}
		}
		Http.httpGetObject(env.server+"/api/surveys/"+surveyId+"/config", function(status, survey){
			for (key in survey){
				if ($("#_"+key).is("textarea")){
					$("#_"+key).html(survey[key]);
				}else if ($("#_"+key).attr("type")=="checkbox"){
					$("#_"+key).prop("checked", survey[key]=="on")
				}else{
					$("#_"+key).val(survey[key]);
				}
			}
		});
		
		// for tinyMCE 5, set the content into the textarea BEFORE initializing tinymce
		tinymce.init({
			  selector: 'textarea',  // change this value according to your HTML
			  plugins: 'code,autoresize,fullpage',
			  toolbar: '', //code - this seems to disable all the other toolbars
		// TODO: Need to find a better way to pull in resources in one call
		//	  content_css: '/assets/css/style.css,/assets/css/survey-progress-panel.css,/assets/themes/rti-theme/css/style.css,/assets/themes/rti-theme/css/results.css'
				// Info: https://www.tiny.cloud/docs-3x/reference/configuration/Configuration3x@content_css/
			  content_css: tiny_content_css
		});
		
	});
	
});


//function nullToEmpty(v){ if (undefined!=v) return v; else return "";}
function newData(){
	var result={};
	$('input[id^=\"_\"],textarea[id^=\"_\"]').each(function() {
		result[this.id.substr(1)]=null;
	});
	return result;
}
function save(){
	var data=populate(newData());
	data={"config":data}; // put it in a config object so it parses into a partial survey on the other end
	Http.send((undefined==surveyId?"POST":"PUT"), env.server+"/api/surveys"+(undefined==surveyId?"":"/"+surveyId+"/config"), data, function(resp, status){
		//jsonToDisplay(resp.response);
		var response=JSON.parse(resp.response);
		//jsonToDisplay2(response["config"],0);
		response=response["config"];
		for (key in response){
			if ($("#_"+key).is("textarea")){
				// check it's not a tinymce editor, if it is then initialise it
				var tinymceeditor=tinymce.get('_'+key);
				if (null!=tinymceeditor)
					$(tinymce.get('_'+key).getBody()).html(response[key]);
				
			}else{
				$("#_"+key).val(response[key]);
			}
		}
		
		showSuccess(200==status?"Saved Ok":"Save Error (Status: "+status+")");
	});
}
function populate(obj){ // html fields to javascript object
	for (key in obj){
		
		if ($("#_"+key).is("textarea")){
			// no value? lets see if it's a tinyMCE rich editor
			obj[key]=tinymce.get("_"+key).getContent({format : 'raw'})
			//obj[key]=obj[key].replaceAll("\n","");
		}else if ($("#_"+key).is("input") && $("#_"+key).prop("type")=="checkbox"){
			obj[key]=$.trim($("#_"+key).prop("checked"));
		}else{
			obj[key]=$.trim($("#_"+key).val());
		}
		
	}
	
	return obj
}

	
	</script>

</body>
</html>